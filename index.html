<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n ARL - Rangel | Microsoft Excel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
body {
  margin:0;
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  height:100vh;
  background:#f0f2f5;
  overflow:hidden;
}

/* ========== PANTALLA DE LOGIN ========== */
.login-screen {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #001f3f 0%, #003366 100%);
  padding: 20px;
}

.login-card {
  background: white;
  border-radius: 15px;
  box-shadow: 0 15px 50px rgba(0,0,0,0.3);
  padding: 50px;
  max-width: 450px;
  text-align: center;
  animation: fadeInScale 0.5s ease-out;
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.login-logo {
  width: 100px;
  height: 100px;
  background: linear-gradient(135deg, #001f3f 0%, #003366 100%);
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 50px;
  margin: 0 auto 25px;
  box-shadow: 0 10px 30px rgba(0, 31, 63, 0.3);
}

.btn-login {
  background: linear-gradient(135deg, #001f3f 0%, #003366 100%);
  color: white;
  font-size: 16px;
  font-weight: 600;
  padding: 14px 35px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.btn-login:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 31, 63, 0.4);
}

#sidebar {
  width:180px;
  background:#001f3f;
  color:white;
  padding:0.5rem;
  padding-top:2.5rem;
  overflow-y:auto;
  position:fixed;
  left:0;
  top:0;
  height:100vh;
  z-index:100;
  transition: left 0.3s ease;
}

#sidebar.collapsed {
  left: -180px;
}

#btnToggleSidebar {
  position: absolute;
  right: 5px;
  top: 5px;
  z-index: 1000;
  background: rgba(255,255,255,0.15);
  color: white;
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 4px;
  padding: 0.3rem 0.5rem;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.9rem;
}

#btnToggleSidebar:hover {
  background: rgba(255,255,255,0.25);
}

#btnToggleSidebarFixed {
  display: none;
  position: fixed;
  left: 5px;
  top: 10px;
  z-index: 1001;
  background: #001f3f;
  color: white;
  border: 2px solid white;
  border-radius: 8px;
  padding: 0.4rem 0.5rem;
  cursor: pointer;
  box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
  font-size: 1rem;
}

#btnToggleSidebarFixed:hover {
  background: #003366;
}

#sidebar h5 {
  color:#c0c0c0;
  margin-bottom:0.4rem;
  text-align:center;
  font-size:0.8rem;
  font-weight:600;
  padding:0.3rem 0;
  line-height:1.2;
}

#sidebar ul {
  list-style:none;
  padding:0;
  margin:0;
}

#sidebar li {
  padding:0.4rem 0.5rem;
  cursor:pointer;
  border-radius:4px;
  margin-bottom:2px;
  position:relative;
  font-size:0.8rem;
  transition:all 0.2s ease;
}

#sidebar li:hover, #sidebar li.active {
  background:#c0c0c0;
  color:#001f3f;
  font-weight:bold;
}

.accordion {
  width:100%;
  margin-top:0.2rem;
}

.accordion-button {
  background:#c0c0c0;
  color:#001f3f;
  font-weight:bold;
  padding:0.3rem 0.4rem;
  font-size:0.7rem;
  line-height:1.2;
}

.accordion-button:not(.collapsed) {
  background:#ff2400;
  color:white;
}

.accordion-body {
  background:#001f3f;
  padding:0.4rem;
}

.accordion-body select {
  width:100%;
  font-size:0.75rem;
  padding:0.25rem;
}

#content {
  margin-left: 180px;
  padding:1rem;
  overflow:auto;
  display:flex;
  flex-direction:column;
  height:100vh;
  transition: margin-left 0.3s ease;
}

#content.expanded {
  margin-left: 0;
}

.filter-panel {
  margin-bottom:0.75rem;
  background:white;
  padding:0.75rem;
  border-radius:0.25rem;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
  flex-shrink:0;
}

.filter-panel h6 {
  font-size:0.9rem;
  margin-bottom:0.5rem;
}

.filter-panel .form-control-sm {
  padding:0.25rem 0.5rem;
  font-size:0.8rem;
}

.table-wrapper {
  flex-grow:1;
  overflow:auto;
  position:relative;
  border:1px solid #ddd;
  border-radius:8px;
  background:white;
}

table {
  width:100%;
  border-collapse:collapse;
  background:white;
}

th, td {
  padding:6px 8px;
  border:1px solid #ddd;
  text-align:left;
  white-space:nowrap;
}

th {
  background:#001f3f;
  color:white;
  position:sticky;
  top:0;
  z-index:10;
  font-size:0.75rem;
  font-weight:600;
}

td {
  font-size:0.85rem;
}

.btn-edit-row {
  padding:0.2rem 0.4rem;
  font-size:0.7rem;
  background:#007bff;
  color:white;
  border:none;
  border-radius:3px;
  cursor:pointer;
  transition:all 0.2s ease;
}

.btn-edit-row:hover {
  background:#0056b3;
  transform:scale(1.05);
}

tr:nth-child(even) {
  background:#f9f9f9;
}

tr:hover {
  background:#d9e6f2;
  cursor:pointer;
}

.semaforo {
  display:flex;
  gap:1rem;
  margin-bottom:0.75rem;
  flex-wrap:wrap;
  flex-shrink:0;
}

.indicador {
  display:flex;
  align-items:center;
  gap:0.5rem;
  cursor:pointer;
  padding:0.4rem 0.8rem;
  border-radius:20px;
  background:#f9f9f9;
  box-shadow:0 1px 3px rgba(0,0,0,0.1);
  transition:transform 0.2s ease;
  font-size:0.85rem;
}

.indicador:hover {
  transform:scale(1.03);
}

.bolita {
  width:14px;
  height:14px;
  border-radius:50%;
}

.verde { background:green; }
.naranja { background:orange; }
.rojo { background:red; }

.table-wrapper::-webkit-scrollbar {
  height:12px;
}

.table-wrapper::-webkit-scrollbar-track {
  background:#f1f1f1;
}

.table-wrapper::-webkit-scrollbar-thumb {
  background:#888;
  border-radius:6px;
}

.table-wrapper::-webkit-scrollbar-thumb:hover {
  background:#555;
}

.table-wrapper {
  overflow-x:scroll !important;
  overflow-y:auto;
}

#modalEditarUsuario .modal-body {
  padding: 0.75rem 1rem;
  max-height: 70vh;
  overflow-y: auto;
}

#modalEditarUsuario .form-label {
  font-size: 0.7rem;
  margin-bottom: 0.15rem;
  font-weight: 600;
  color: #2c3e50;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

#modalEditarUsuario .form-control,
#modalEditarUsuario .form-select,
#modalEditarUsuario textarea {
  font-size: 0.75rem;
  padding: 0.25rem 0.4rem;
  height: 28px;
  border-radius: 4px;
  border: 1px solid #cbd5e0;
  transition: border-color 0.2s ease;
}

#modalEditarUsuario .form-control:focus,
#modalEditarUsuario .form-select:focus,
#modalEditarUsuario textarea:focus {
  border-color: #007bff;
  box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
}

#modalEditarUsuario textarea {
  height: 50px !important;
  resize: vertical;
  min-height: 50px;
}

#modalEditarUsuario .mb-2 { 
  margin-bottom: 0.4rem !important; 
}

#modalEditarUsuario .row.g-2 { 
  gap: 0.4rem; 
  row-gap: 0.4rem !important;
}

#modalEditarUsuario .cita-fecha-input {
  padding: 0.25rem 0.4rem;
  height: 28px;
  font-size: 0.75rem;
}

#modalEditarUsuario .seccion-form {
  background: white;
  padding: 0.65rem;
  border-radius: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.06);
  margin-bottom: 0.6rem;
}

#modalEditarUsuario .seccion-titulo {
  color: #001f3f;
  font-size: 0.85rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  padding-bottom: 0.3rem;
  border-bottom: 2px solid #007bff;
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

@media (min-width: 992px) {
  #modalEditarUsuario .col-form { 
    width: 25% !important;
    flex: 0 0 25%;
    max-width: 25%;
  }
  
  #modalEditarUsuario .col-form-wide {
    width: 50% !important;
    flex: 0 0 50%;
    max-width: 50%;
  }
  
  #modalEditarUsuario .col-form-full {
    width: 100% !important;
    flex: 0 0 100%;
    max-width: 100%;
  }
}

@media (min-width: 768px) and (max-width: 991px) {
  #modalEditarUsuario .col-form { 
    width: 50% !important;
    flex: 0 0 50%;
  }
}

@media (max-width: 767px) {
  #modalEditarUsuario .col-form,
  #modalEditarUsuario .col-form-wide,
  #modalEditarUsuario .col-form-full { 
    width: 100% !important;
    flex: 0 0 100%;
  }
}

.semaforo-container {
  background:white;
  padding:0.5rem 0.75rem;
  border-radius:0.25rem;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
  margin-bottom:0.5rem;
  flex-shrink:0;
}

.indicador-cita {
  display:flex;
  align-items:center;
  gap:0.3rem;
  font-size:0.75rem;
  transition:all 0.2s ease;
  box-shadow:0 1px 3px rgba(0,0,0,0.1);
  cursor:pointer;
}

.indicador-cita:hover {
  transform:scale(1.05);
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
}

.indicador-cita:active {
  transform:scale(0.98);
}

.dashboard-container {
  background: linear-gradient(135deg, #001f3f 0%, #c0c0c0 100%);
  border-radius: 12px;
  padding: 1rem;
  margin-bottom: 1rem;
  box-shadow: 0 4px 15px rgba(0,0,0,0.15);
  flex-shrink: 0;
  animation: slideDown 0.4s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.dashboard-header h6 {
  color: white;
  margin: 0;
  font-weight: 600;
  font-size: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-toggle-dashboard {
  background: rgba(255,255,255,0.2);
  border: 1px solid rgba(255,255,255,0.3);
  color: white;
  padding: 0.3rem 0.6rem;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 0.9rem;
}

.btn-toggle-dashboard:hover {
  background: rgba(255,255,255,0.3);
  transform: scale(1.05);
}

.btn-show-dashboard {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 999;
  background: linear-gradient(135deg, #001f3f 0%, #c0c0c0 100%);
  color: white;
  border: none;
  padding: 0.6rem 1.2rem;
  border-radius: 25px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  font-weight: 600;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  animation: fadeIn 0.4s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.8); }
  to { opacity: 1; transform: scale(1); }
}

.btn-show-dashboard:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.3);
}

.dashboard-content {
  animation: fadeIn 0.3s ease-out;
}

.stat-card {
  background: white;
  border-radius: 10px;
  padding: 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  height: 100%;
  min-height: 85px;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.stat-icon {
  font-size: 2rem;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  flex-shrink: 0;
}

.stat-primary .stat-icon { background: #e3f2fd; color: #1976d2; }
.stat-success .stat-icon { background: #e8f5e9; color: #2e7d32; }
.stat-warning .stat-icon { background: #fff3e0; color: #f57c00; }
.stat-info .stat-icon { background: #e1f5fe; color: #0288d1; }
.stat-danger .stat-icon { background: #fce4ec; color: #c2185b; }
.stat-secondary .stat-icon { background: #f3e5f5; color: #7b1fa2; }

.stat-info-text {
  flex-grow: 1;
}

.stat-label {
  font-size: 0.7rem;
  color: #666;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.25rem;
}

.stat-value {
  font-size: 1.75rem;
  font-weight: 700;
  color: #2c3e50;
  line-height: 1;
}

.stat-percentage {
  font-size: 0.75rem;
  color: #999;
  margin-top: 0.2rem;
}

.stat-table-container {
  background: white;
  border-radius: 10px;
  padding: 0.75rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  height: 100%;
}

.stat-table-title {
  font-size: 0.85rem;
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.stat-table-scroll {
  max-height: 200px;
  overflow-y: auto;
}

.stat-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.8rem;
}

.stat-table thead {
  position: sticky;
  top: 0;
  background: #f8f9fa;
  z-index: 10;
}

.stat-table th {
  padding: 0.5rem;
  text-align: left;
  font-weight: 600;
  color: #495057;
  border-bottom: 2px solid #dee2e6;
  font-size: 0.75rem;
  text-transform: uppercase;
}

.stat-table td {
  padding: 0.5rem;
  border-bottom: 1px solid #f0f0f0;
  color: #495057;
}

.stat-table tbody tr:hover {
  background: #f8f9fa;
}

.stat-table-scroll::-webkit-scrollbar {
  width: 6px;
}

.stat-table-scroll::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 3px;
}

.stat-table-scroll::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 3px;
}

.stat-table-scroll::-webkit-scrollbar-thumb:hover {
  background: #555;
}

@media (max-width: 768px) {
  .stat-card {
    min-height: 70px;
  }
  
  .stat-icon {
    font-size: 1.5rem;
    width: 40px;
    height: 40px;
  }
  
  .stat-value {
    font-size: 1.3rem;
  }
}

/* Loading Overlay */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  backdrop-filter: blur(4px);
}

.loading-overlay.show {
  display: flex;
}

.loading-content {
  background: white;
  padding: 40px 60px;
  border-radius: 15px;
  text-align: center;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  animation: fadeInScale 0.3s ease-out;
}

.spinner {
  border: 5px solid #f3f3f3;
  border-top: 5px solid #001f3f;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.user-info {
  margin-top: auto;
  padding-top: 20px;
  border-top: 1px solid rgba(255,255,255,0.2);
  font-size: 0.75rem;
}

.btn-logout {
  width: 100%;
  padding: 8px;
  background: #dc3545;
  border: none;
  color: white;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.75rem;
  font-weight: 600;
  margin-top: 10px;
}

.btn-logout:hover {
  background: #c82333;
  transform: scale(1.02);
}
    </style>
</head>
<body>
    <!-- ========== PANTALLA DE LOGIN ========== -->
    <div id="loginScreen" class="login-screen">
        <div class="login-card">
            <div class="login-logo">
                <i class="bi bi-hospital"></i>
            </div>
            <h2 style="margin-bottom: 12px; color: #001f3f; font-weight: 700;">Gesti√≥n ARL Rangel</h2>
            <p style="color: #6c757d; margin-bottom: 35px; font-size: 15px;">Sistema de Seguimiento M√©dico | Microsoft Excel</p>
            <button class="btn-login" onclick="iniciarSesionMicrosoft()">
                <i class="bi bi-microsoft" style="font-size: 22px;"></i>
                <span>Iniciar sesi√≥n con Microsoft</span>
            </button>
            <p style="margin-top: 25px; font-size: 12px; color: #999;">
                Versi√≥n 7.0 - Microsoft Graph API Integration
            </p>
        </div>
    </div>

    <!-- ========== APLICACI√ìN PRINCIPAL ========== -->
    <div id="mainApp" style="display: none;">
        <!-- SIDEBAR -->
        <nav id="sidebar">
            <button id="btnToggleSidebar" onclick="toggleSidebar()" title="Ocultar men√∫">
                <i class="bi bi-chevron-left"></i>
            </button>
            
            <h5>Seguimiento ARL - Rangel</h5>
            <ul id="aseguradoresList"></ul>
            
            <div class="mt-2 text-center">
                <button id="btnAbrirAgregar" class="btn btn-success btn-sm w-100" data-bs-toggle="modal" data-bs-target="#modalAgregarUsuario" style="font-size:0.75rem; padding:0.35rem 0.4rem;">
                    ‚ûï Agregar
                </button>
            </div>

            <div class="user-info">
                <p id="userEmail" style="margin-bottom: 5px; opacity: 0.9; word-break: break-word;"></p>
                <button class="btn-logout" onclick="cerrarSesion()">
                    <i class="bi bi-box-arrow-right"></i> Cerrar Sesi√≥n
                </button>
            </div>
        </nav>

        <button id="btnToggleSidebarFixed" onclick="toggleSidebar()" title="Mostrar men√∫">
            <i class="bi bi-chevron-right"></i>
        </button>

        <main id="content">
            <!-- DASHBOARD -->
            <div id="dashboardPanel" class="dashboard-container" style="display:none;">
                <div class="dashboard-header">
                    <h6><i class="bi bi-graph-up-arrow"></i> Dashboard Estad√≠stico - <span id="dashboardHojaActual">---</span></h6>
                    <button class="btn-toggle-dashboard" onclick="toggleDashboard()" title="Ocultar dashboard">
                        <i class="bi bi-chevron-up"></i>
                    </button>
                </div>
                
                <div class="dashboard-content" id="dashboardContent">
                    <div class="row g-2">
                        <div class="col-md-4 col-lg-2">
                            <div class="stat-card stat-primary">
                                <div class="stat-icon"><i class="bi bi-people-fill"></i></div>
                                <div class="stat-info-text">
                                    <div class="stat-label">Casos Activos</div>
                                    <div class="stat-value" id="stat-poblacion-total">0</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-lg-2">
                            <div class="stat-card stat-success">
                                <div class="stat-icon"><i class="bi bi-person-check-fill"></i></div>
                                <div class="stat-info-text">
                                    <div class="stat-label">Poblaci√≥n Activa</div>
                                    <div class="stat-value" id="stat-pacientes-unicos">0</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-lg-2">
                            <div class="stat-card stat-warning">
                                <div class="stat-icon"><i class="bi bi-exclamation-triangle-fill"></i></div>
                                <div class="stat-info-text">
                                    <div class="stat-label">Siniestros Totales</div>
                                    <div class="stat-value" id="stat-siniestros">0</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-2">
                            <div class="stat-card stat-info">
                                <div class="stat-icon"><i class="bi bi-gender-male"></i></div>
                                <div class="stat-info-text">
                                    <div class="stat-label">Masculino</div>
                                    <div class="stat-value" id="stat-masculino">0</div>
                                    <div class="stat-percentage" id="stat-masculino-pct">0%</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-2">
                            <div class="stat-card stat-danger">
                                <div class="stat-icon"><i class="bi bi-gender-female"></i></div>
                                <div class="stat-info-text">
                                    <div class="stat-label">Femenino</div>
                                    <div class="stat-value" id="stat-femenino">0</div>
                                    <div class="stat-percentage" id="stat-femenino-pct">0%</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-lg-2">
                            <div class="stat-card stat-secondary">
                                <div class="stat-icon"><i class="bi bi-gender-ambiguous"></i></div>
                                <div class="stat-info-text">
                                    <div class="stat-label">Otro</div>
                                    <div class="stat-value" id="stat-otro">0</div>
                                    <div class="stat-percentage" id="stat-otro-pct">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row g-2 mt-2">
                        <div class="col-md-6">
                            <div class="stat-table-container">
                                <h6 class="stat-table-title"><i class="bi bi-person-badge"></i> Pacientes por Auditor</h6>
                                <div class="stat-table-scroll">
                                    <table class="stat-table" id="tabla-auditores">
                                        <thead>
                                            <tr>
                                                <th>Auditor</th>
                                                <th style="text-align:center;">Cantidad</th>
                                                <th style="text-align:center;">%</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbody-auditores">
                                            <tr><td colspan="3" style="text-align:center; color:#999;">Sin datos</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="stat-table-container">
                                <h6 class="stat-table-title"><i class="bi bi-clipboard-data"></i> Clasificaci√≥n de Severidad</h6>
                                <div class="stat-table-scroll">
                                    <table class="stat-table" id="tabla-severidad">
                                        <thead>
                                            <tr>
                                                <th>Clasificaci√≥n</th>
                                                <th style="text-align:center;">Cantidad</th>
                                                <th style="text-align:center;">%</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbody-severidad">
                                            <tr><td colspan="3" style="text-align:center; color:#999;">Sin datos</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button id="btnMostrarDashboard" class="btn-show-dashboard" onclick="toggleDashboard()" style="display:none;" title="Mostrar dashboard">
                <i class="bi bi-graph-up-arrow"></i> Estad√≠sticas
            </button>

            <!-- SECCI√ìN COMBINADA: SEM√ÅFORO 1 + FILTRO EN DOS COLUMNAS -->
            <div style="display:grid; grid-template-columns: 2.5fr 1.5fr 1fr; gap:0.5rem; margin-bottom:0.75rem; align-items:start;">
                <!-- COLUMNA 1: SEM√ÅFORO DE SEGUIMIENTO -->
                <div class="semaforo-container" style="margin-bottom:0;">
                    <h6 style="font-size:0.75rem; font-weight:500; color:#001f3f; margin-bottom:0.3rem;">üìÖ Seguimiento de Pacientes</h6>
                    <div class="semaforo">
                        <div class="indicador" onclick="filtrarPorSemaforo('verde')" title="Filtrar 0‚Äì5 d√≠as">
                            <div class="bolita verde"></div>
                            <span id="conteo-verde">0</span> pacientes (0‚Äì5 d√≠as)
                        </div>
                        <div class="indicador" onclick="filtrarPorSemaforo('naranja')" title="Filtrar 6‚Äì12 d√≠as">
                            <div class="bolita naranja"></div>
                            <span id="conteo-naranja">0</span> pacientes (6‚Äì12 d√≠as)
                        </div>
                        <div class="indicador" onclick="filtrarPorSemaforo('rojo')" title="Filtrar 13+ d√≠as">
                            <div class="bolita rojo"></div>
                            <span id="conteo-rojo">0</span> pacientes (13+ d√≠as)
                        </div>
                        <div class="indicador" onclick="filtrarPorSemaforo('todos')" title="Quitar filtro sem√°foro">
                            üîÑ Ver todos
                        </div>
                    </div>
                </div>
                
                <!-- COLUMNA 2: FILTRO DE FECHA -->
                <div class="filter-panel" style="margin-bottom:0; padding:0.6rem; background:white; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
                    <h6 style="font-size:0.7rem; font-weight:600; color:#001f3f; margin-bottom:0.4rem; display:flex; align-items:center; gap:0.3rem;">
                        <i class="bi bi-calendar-event"></i> Filtro por Fecha de Ingreso
                    </h6>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:0.3rem; margin-bottom:0.4rem;">
                        <div>
                            <label style="font-size:0.6rem; font-weight:600; color:#666; margin-bottom:0.1rem; display:block;">Desde</label>
                            <input type="date" id="fechaDesde" class="form-control form-control-sm" style="font-size:0.7rem; padding:0.25rem 0.3rem; height:24px; border:1px solid #cbd5e0; border-radius:4px;">
                        </div>
                        <div>
                            <label style="font-size:0.6rem; font-weight:600; color:#666; margin-bottom:0.1rem; display:block;">Hasta</label>
                            <input type="date" id="fechaHasta" class="form-control form-control-sm" style="font-size:0.7rem; padding:0.25rem 0.3rem; height:24px; border:1px solid #cbd5e0; border-radius:4px;">
                        </div>
                    </div>
                </div>
                
                <!-- COLUMNA 3: B√öSQUEDA DE TEXTO -->
                <div class="filter-panel" style="margin-bottom:0; padding:0.6rem; background:white; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);">
                    <h6 style="font-size:0.7rem; font-weight:600; color:#001f3f; margin-bottom:0.4rem; display:flex; align-items:center; gap:0.3rem;">
                        <i class="bi bi-search"></i> B√∫squeda
                    </h6>
                    <input type="text" id="searchFree" class="form-control form-control-sm" placeholder="Buscar..." style="font-size:0.7rem; padding:0.35rem 0.5rem; border:1px solid #001f3f; border-radius:4px; margin-bottom:0.3rem;">
                    <button class="btn btn-dark btn-sm w-100" onclick="aplicarFiltros()" style="font-weight:600; font-size:0.65rem; padding:0.3rem; border-radius:4px; background:#001f3f; border:none; margin-bottom:0.2rem;">
                        <i class="bi bi-search"></i> Buscar
                    </button>
                    <button class="btn btn-outline-secondary btn-sm w-100" onclick="limpiarFiltros()" style="font-weight:600; font-size:0.6rem; padding:0.25rem; border-radius:4px;">
                        <i class="bi bi-x-circle"></i> Limpiar
                    </button>
                </div>
            </div>

            <!-- SEM√ÅFORO 2: CITAS M√âDICAS -->
            <div id="semaforoCitas" class="semaforo-container" style="display:none;">
                <h6 style="font-size:0.75rem; font-weight:600; color:#001f3f; margin-bottom:0.5rem;">üè• Control de Citas M√©dicas</h6>
                
                <!-- SECCI√ìN: CITAS PENDIENTES -->
                <div style="background:#f8f9fa; padding:0.5rem; border-radius:8px; margin-bottom:0.5rem;">
                    <h6 style="font-size:0.7rem; font-weight:600; color:#2e7d32; margin-bottom:0.3rem; display:flex; align-items:center; gap:0.3rem;">
                        <i class="bi bi-calendar-check"></i> Citas Pendientes
                    </h6>
                    <div class="semaforo" style="flex-wrap:wrap;">
                        <div class="indicador-cita" onclick="filtrarPorCitaVacia('FISIATRA')" style="background:#e3f2fd; border:1px solid #1976d2; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar">
                            <span style="font-weight:600; color:#1976d2;">ü©∫ Fisiatra:</span>
                            <span id="conteo-fisiatra" style="font-weight:bold; color:#1976d2;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorCitaVacia('JUNTA MEDICA')" style="background:#f3e5f5; border:1px solid #7b1fa2; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar">
                            <span style="font-weight:600; color:#7b1fa2;">üë• Junta M√©dica:</span>
                            <span id="conteo-junta" style="font-weight:bold; color:#7b1fa2;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorCitaVacia('VALORACION OCUPACIONAL')" style="background:#fff3e0; border:1px solid #e65100; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar">
                            <span style="font-weight:600; color:#e65100;">üíº Valoraci√≥n Ocup.:</span>
                            <span id="conteo-valoracion" style="font-weight:bold; color:#e65100;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorCitaVacia('MEDICINA LABORAL')" style="background:#e8f5e9; border:1px solid #2e7d32; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar">
                            <span style="font-weight:600; color:#2e7d32;">‚öïÔ∏è Medicina Lab.:</span>
                            <span id="conteo-medicina-laboral" style="font-weight:bold; color:#2e7d32;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorCitaVacia('PSICOLOGIA')" style="background:#fce4ec; border:1px solid #c2185b; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar">
                            <span style="font-weight:600; color:#c2185b;">üß† Psicolog√≠a:</span>
                            <span id="conteo-psicologia" style="font-weight:bold; color:#c2185b;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorCitaVacia('TERAPIA OCUPACIONAL')" style="background:#e0f2f1; border:1px solid #00695c; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar">
                            <span style="font-weight:600; color:#00695c;">üõ†Ô∏è Terapia Ocup.:</span>
                            <span id="conteo-terapia-ocupacional" style="font-weight:bold; color:#00695c;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorCitaVacia('TERAPIA FISICA')" style="background:#fff9c4; border:1px solid #f57f17; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar">
                            <span style="font-weight:600; color:#f57f17;">üèÉ Terapia F√≠sica:</span>
                            <span id="conteo-terapia-fisica" style="font-weight:bold; color:#f57f17;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorCitaVacia('todos')" style="background:#eceff1; border:2px solid #546e7a; padding:0.3rem 0.8rem; border-radius:15px;" title="Click para quitar filtros">
                            <span style="font-weight:600; color:#546e7a;">üîÑ Ver todos</span>
                        </div>
                    </div>
                </div>
                
                <!-- SECCI√ìN: INASISTENCIAS -->
                <div style="background:#fff5f5; padding:0.5rem; border-radius:8px; border-left:4px solid #d9534f;">
                    <h6 style="font-size:0.7rem; font-weight:600; color:#d9534f; margin-bottom:0.3rem; display:flex; align-items:center; gap:0.3rem;">
                        <i class="bi bi-x-circle-fill"></i> Inasistencias Registradas
                    </h6>
                    <div class="semaforo" style="flex-wrap:wrap;">
                        <div class="indicador-cita" onclick="filtrarPorInasistencia('FISIATRA')" style="background:#ffebee; border:1px solid #c62828; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar inasistencias">
                            <span style="font-weight:600; color:#c62828;">ü©∫ Fisiatra:</span>
                            <span id="inasistencia-fisiatra" style="font-weight:bold; color:#c62828;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorInasistencia('JUNTA MEDICA')" style="background:#ffebee; border:1px solid #c62828; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar inasistencias">
                            <span style="font-weight:600; color:#c62828;">üë• Junta M√©dica:</span>
                            <span id="inasistencia-junta" style="font-weight:bold; color:#c62828;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorInasistencia('VALORACION OCUPACIONAL')" style="background:#ffebee; border:1px solid #c62828; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar inasistencias">
                            <span style="font-weight:600; color:#c62828;">üíº Valoraci√≥n Ocup.:</span>
                            <span id="inasistencia-valoracion" style="font-weight:bold; color:#c62828;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorInasistencia('MEDICINA LABORAL')" style="background:#ffebee; border:1px solid #c62828; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar inasistencias">
                            <span style="font-weight:600; color:#c62828;">‚öïÔ∏è Medicina Lab.:</span>
                            <span id="inasistencia-medicina-laboral" style="font-weight:bold; color:#c62828;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorInasistencia('PSICOLOGIA')" style="background:#ffebee; border:1px solid #c62828; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar inasistencias">
                            <span style="font-weight:600; color:#c62828;">üß† Psicolog√≠a:</span>
                            <span id="inasistencia-psicologia" style="font-weight:bold; color:#c62828;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorInasistencia('TERAPIA OCUPACIONAL')" style="background:#ffebee; border:1px solid #c62828; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar inasistencias">
                            <span style="font-weight:600; color:#c62828;">üõ†Ô∏è Terapia Ocup.:</span>
                            <span id="inasistencia-terapia-ocupacional" style="font-weight:bold; color:#c62828;">0</span>
                        </div>
                        <div class="indicador-cita" onclick="filtrarPorInasistencia('TERAPIA FISICA')" style="background:#ffebee; border:1px solid #c62828; padding:0.3rem 0.6rem; border-radius:15px;" title="Click para filtrar inasistencias">
                            <span style="font-weight:600; color:#c62828;">üèÉ Terapia F√≠sica:</span>
                            <span id="inasistencia-terapia-fisica" style="font-weight:bold; color:#c62828;">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TABLA DE DATOS -->
            <div class="table-wrapper">
                <table id="tablaDatos">
                    <thead id="tablaHead"></thead>
                    <tbody id="tablaBody"></tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- ========== MODAL AGREGAR USUARIO ========== -->
    <div class="modal fade" id="modalAgregarUsuario" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title">‚ûï Agregar Usuario</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formAgregarUsuario">
                        <div class="row g-2">
                            <div class="col-md-4">
                                <label class="form-label">Asegurador</label>
                                <select class="form-select" name="hoja" required>
                                    <option value="">-- Seleccione --</option>
                                    <option value="Positiva">Positiva</option>
                                    <option value="Colmena">Colmena</option>
                                    <option value="Colsanitas">Colsanitas</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label d-block">Paciente por Evento</label>
                                <div class="form-check" style="padding-top:0.4rem;">
                                    <input class="form-check-input" type="checkbox" name="PACIENTE_EVENTO" id="checkPacienteEvento">
                                    <label class="form-check-label" for="checkPacienteEvento" style="font-size:0.85rem;">
                                        S√≠, es paciente por evento
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-4"></div>
                            <div class="col-md-4"><label class="form-label">SINIESTRO</label><input class="form-control" name="SINIESTRO"></div>
                            <div class="col-md-4"><label class="form-label"># MATRICULA</label><input class="form-control" name="# MATRICULA"></div>
                            <div class="col-md-4"><label class="form-label">CEDULA</label><input class="form-control" name="CEDULA"></div>
                            <div class="col-md-4"><label class="form-label">NOMBRE</label><input class="form-control" name="NOMBRE"></div>
                            <div class="col-md-4"><label class="form-label">FECHA DE ASIGNACION A LA IPS</label><input type="date" class="form-control" name="FECHA DE ASIGNACION A LA IPS"></div>
                            <div class="col-md-4">
                                <label class="form-label">GENERO</label>
                                <select class="form-select" name="GENERO">
                                    <option value="">-- Seleccione --</option>
                                    <option>Masculino</option>
                                    <option>Femenino</option>
                                    <option>Otro</option>
                                </select>
                            </div>
                            <div class="col-md-4"><label class="form-label">MAYOR A 56 A√ëOS SI O NO</label>
                                <select class="form-select" name="MAYOR A 56 A√ëOS SI O NO">
                                    <option value="">-- Seleccione --</option>
                                    <option>SI</option>
                                    <option>NO</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">CLASIFICACION SEVERIDAD</label>
                                <select class="form-select" name="CLASIFICACION SEVERIDAD">
                                    <option value="">-- Seleccione --</option>
                                    <option>AT Caso Muy Leve</option>
                                    <option>AT Caso Leve</option>
                                    <option>AT Caso Moderado</option>
                                    <option>AT Caso Grave</option>
                                    <option>AT Caso Muy Grave</option>
                                    <option>AT Caso Severo</option>
                                    <option>Enfermedad Laboral</option>
                                </select>
                            </div>
                            <div class="col-md-4"><label class="form-label">CITA INICIAL</label><input type="date" class="form-control" name="CITA INICIAL"></div>
                            <div class="col-md-4"><label class="form-label">ALTA INMEDIATA</label><input class="form-control" name="ALTA INMEDIATA"></div>
                            <div class="col-md-4"><label class="form-label">ESTADO DE LA MATRICULA</label><input class="form-control" name="ESTADO DE LA MATRICULA"></div>
                            <div class="col-md-4"><label class="form-label">FECHA CIERRE</label><input type="date" class="form-control" name="FECHA CIERRE"></div>
                            <div class="col-md-4"><label class="form-label">NUM AGENDAMIENTOS y CITAS FORMALES INICIALES</label><input type="number" class="form-control" name="NUM AGENDAMIENTOS y CITAS FORMALES INICIALES"></div>
                            <div class="col-md-4"><label class="form-label">OBSERVACION</label><textarea class="form-control" name="OBSERVACION"></textarea></div>
                            <div class="col-md-4"><label class="form-label">SEGUIMIENTO DE IMAGENES/NOVEDAD FUERA DE LOS TIEMPOR</label><textarea class="form-control" name="SEGUIMIENTO DE IMAGENES/NOVEDAD FUERA DE LOS TIEMPOR"></textarea></div>
                            <div class="col-md-4">
                                <label class="form-label">AUDITOR</label>
                                <select class="form-select" name="AUDITOR">
                                    <option value="">-- Seleccione --</option>
                                    <option>FABIAN MACIAS</option>
                                    <option>YANETH OBREGON</option>
                                    <option>MELISA SANCHEZ</option>
                                    <option>ANGELA LOPEZ</option>
                                    <option>ADRIANA VILLOTA</option>
                                    <option>YULAINE VERGARA</option>
                                </select>
                            </div>
                            <div class="col-md-4"><label class="form-label">OBSERVACION FACTURACION</label><textarea class="form-control" name="OBSERVACION FACTURACION"></textarea></div>
                            <div class="col-md-4"><label class="form-label">Fecha √öltimo Seguimiento</label><input type="date" class="form-control" name="Fecha √öltimo Seguimiento"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" id="btnGuardarUsuario">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MODAL EDITAR USUARIO ========== -->
    <div class="modal fade" id="modalEditarUsuario" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content" style="border:none; box-shadow:0 8px 32px rgba(0,0,0,0.12);">
                <div class="modal-header" style="background: linear-gradient(135deg, #001f3f 0%, #003366 100%); border:none; padding:1rem 1.25rem;">
                    <h5 class="modal-title text-white" style="font-size:1.1rem; font-weight:600; letter-spacing:0.3px;">
                        <i class="bi bi-pencil-square" style="font-size:1rem;"></i> Editar Usuario
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="background:#f8f9fa;">
                    <form id="formEditarUsuario">
                        <input type="hidden" id="editRowIndex" name="rowIndex">
                        <div class="seccion-form">
                            <h6 class="seccion-titulo">
                                <i class="bi bi-person-badge" style="font-size:0.9rem;"></i> Informaci√≥n del Paciente
                            </h6>
                            <div id="seccionPaciente" class="row g-2"></div>
                        </div>
                        <div style="height:1px; background:linear-gradient(to right, transparent, #cbd5e0 20%, #cbd5e0 80%, transparent); margin:0.8rem 0;"></div>
                        <div class="seccion-form">
                            <h6 class="seccion-titulo">
                                <i class="bi bi-clipboard-check" style="font-size:0.9rem;"></i> Seguimiento y Estado
                            </h6>
                            <div id="seccionSeguimiento" class="row g-2"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="background:#f8f9fa; border-top:1px solid #dee2e6; padding:0.75rem 1rem; display:flex; align-items:center; gap:0.5rem;">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal" style="padding:0.4rem 1rem; font-weight:500; font-size:0.85rem;">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </button>
                    <div style="flex-grow:1; max-width:350px;">
                        <label class="form-label" style="font-size:0.75rem; margin-bottom:0.25rem; font-weight:600; color:#d9534f;">
                            * Tipo de Cierre (requerido para cerrar caso)
                        </label>
                        <select class="form-select form-select-sm" id="selectTipoCierre" style="font-size:0.8rem; border:1px solid #ced4da;">
                            <option value="">-- Seleccione motivo de cierre --</option>
                            <option value="Cierre Caso Auditor">Cierre Caso Auditor</option>
                            <option value="Cierre Caso Desertor">Cierre Caso Desertor</option>
                            <option value="Cierre Caso Acta">Cierre Caso Acta</option>
                            <option value="Cierre Caso Finaliz√≥ Ciclo">Cierre Caso Finaliz√≥ Ciclo</option>
                        </select>
                    </div>
                    <button type="button" class="btn btn-warning btn-sm" id="btnCerrarCaso" style="padding:0.4rem 1rem; font-weight:500; font-size:0.85rem;">
                        <i class="bi bi-folder-x"></i> Cerrar Caso
                    </button>
                    <button type="button" class="btn btn-primary btn-sm" id="btnActualizarUsuario" style="padding:0.4rem 1rem; font-weight:500; font-size:0.85rem; background:#001f3f; border:none;">
                        <i class="bi bi-check-circle"></i> Actualizar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== LOADING OVERLAY ========== -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loadingMessage" style="margin: 0; color: #001f3f; font-weight: 600; font-size: 16px;">Cargando...</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="code-microsoft.js"></script>
</body>
</html>
